# 小说下载器

这是一个功能强大的小说下载脚本，使用 Python 编写，可以从 [xbookcn.net](https://book.xbookcn.net/) 网站下载长篇和短篇小说。

## 主要功能

- **双模式下载**: 支持两种主要的小说类型：
  1.  **长篇小说**: 通过输入小说名称进行搜索和下载，自动获取所有章节并合并成一个 `.txt` 文件。
  2.  **短篇小说**: 支持按分类进行下载，提供更精细的下载体验。
- **智能分类系统**:
  -   可以一键从网站更新所有短篇小说的分类列表。
  -   自动过滤掉无关的按时间归档的分类，使列表更清晰。
  -   将分类列表保存在本地 (`categories/short_story_categories.json`)，避免每次都重新下载。
- **灵活的下载选项**:
  -   下载短篇小说时，会清晰地列出所有可用的分类供您选择。
  -   选定分类后，会列出该分类下的所有小说。
  -   您可以选择下载**单篇**小说（通过输入编号或名称），也可以直接按回车键下载该分类下的**全部**小说。
- **高度可配置**:
  -   通过 `config.json` 文件，您可以轻松指定所有小说的保存路径。
- **稳定可靠**:
  -   内置网络请求重试机制，在网络波动时自动重试，提高下载成功率。
  -   自动处理文件名和目录名中的非法字符，确保文件能被成功保存。

## 文件结构

```
.
├── .venv/                  # Python 虚拟环境 (被 .gitignore 忽略)
├── categories/             # 存放短篇小说分类文件 (被 .gitignore 忽略)
├── chapters/               # 存放长篇小说的章节列表缓存 (被 .gitignore 忽略)
├── novels/                 # 默认的小说保存目录 (被 .gitignore 忽略)
├── .gitignore              # Git 忽略文件配置
├── config.json             # 配置文件
├── downloader.py           # 主程序脚本
├── requirements.txt        # 依赖库
└── README.md               # 本说明文件
```

## 安装与配置

1.  **创建虚拟环境**:
    ```bash
    python -m venv .venv
    ```

2.  **激活虚拟环境**:
    -   Windows:
        ```bash
        .venv\Scripts\activate
        ```
    -   macOS / Linux:
        ```bash
        source .venv/bin/activate
        ```

3.  **安装依赖**:
    ```bash
    pip install -r requirements.txt
    ```
    *注意: `requirements.txt` 包含 `requests` 和 `beautifulsoup4`。*

4.  **配置下载路径**:
    -   打开 `config.json` 文件。
    -   修改 `download_path` 的值为您希望保存小说的本地路径。请使用正斜杠 `/` 作为路径分隔符。
    -   示例:
        ```json
        {
            "download_path": "D:/MyNovels"
        }
        ```

## 使用方法

直接运行主脚本即可启动程序：

```bash
python downloader.py
```

程序启动后，您会看到一个菜单，根据提示输入数字选择您想执行的操作：

-   **1. 下载长篇小说 (通过名称搜索)**:
    -   输入长篇小说的准确名称，程序会自动搜索、下载并合并所有章节。

-   **2. 下载短篇小说 (按分类下载)**:
    -   程序会列出所有本地已保存的分类。
    -   输入您想下载的**分类编号**或**分类名称**。
    -   接着，程序会列出该分类下的所有小说。
    -   输入**小说编号**或**小说名称**来下载单篇，或直接按**回车**下载该分类下的全部小说。

-   **3. 更新短篇小说分类列表**:
    -   当您想获取最新的短篇小说分类时，选择此项。程序会重新从网站抓取并覆盖本地的分类文件。

-   **4. 退出**:
    -   结束程序。
